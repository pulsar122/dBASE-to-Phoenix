/* * This file contains some routines for handling xBase files. * It is pubilshed under the GNU Gerneral Public License (GPL), * see COPYING for details. * * WARNING: This is ALPHA code!!! *          Writing xbase files is NOT full supported until now!!! *          Index files are also not supported :( * * (c) rasca, berlin 1994, 1995, 1996 * (rasca@marie.physik.tu-berlin.de) */#include <windows.h>	/* needed for the windows support */#include <commdlg.h>	/* GetOpenFileName() */#include <string.h>		/* memset() */#include <stdio.h>		/* cause of dbf.h */#include "dbf.h"        /* core xbase routines and types etc.. */#include "dbfdll.h"		/* exported functions */int FAR PASCAL EXPORT dbOpenW (LPCSTR dir, int mode) {	OPENFILENAME ofn;	const char pattern[] = "xBase Files (*.dbf)|*.dbf|All Files (*.*)|*.*|";	char szFilter[512];	char szFile[512];	char szFileTitle[512];	int i;	memcpy (szFilter, pattern, sizeof (pattern));	for (i = 0; szFilter[i]	!= '\0'; i++) {		if (szFilter[i] == '|') {			szFilter[i] = '\0';		}	}	szFile[0] = '\0';		memset (&ofn, 0, sizeof(OPENFILENAME));	ofn.lStructSize = sizeof(OPENFILENAME);	ofn.hwndOwner = (HWND) 0;	ofn.lpstrFilter = szFilter;	ofn.lpstrCustomFilter = NULL;	ofn.nFilterIndex = 1;	ofn.lpstrFile = szFile;	ofn.nMaxFile = sizeof (szFile);	ofn.lpstrFileTitle = szFileTitle;	ofn.nMaxFileTitle = sizeof (szFileTitle);	ofn.lpstrInitialDir = dir;	ofn.lpstrTitle = "";	if (mode & DB_WRITE) {		ofn.Flags = OFN_PATHMUSTEXIST | OFN_FILEMUSTEXIST;	} else {		ofn.Flags = OFN_READONLY | OFN_PATHMUSTEXIST | OFN_FILEMUSTEXIST;	}	ofn.lpstrDefExt = "dbf";	if (GetOpenFileName (&ofn)) {		if (ofn.Flags & OFN_READONLY) {			mode |= DB_READ;			mode &= ~DB_WRITE;		} else {			mode |= DB_WRITE;			mode &= ~DB_READ;		}		return (dbOpen (ofn.lpstrFile, mode));	} else {		if (CommDlgExtendedError() != 0) {			MessageBox ((HWND)0, "Error while calling 'GetOpenFileName()'", "Error", MB_ICONEXCLAMATION);		} 	}	return (0);}